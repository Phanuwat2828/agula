
<div style="margin-bottom: 20px; display: flex; flex-direction: row ;">
    <button mat-raised-button color="primary" (click)="reset()">Reset Filter</button>
    <div class="search-container">
        <div class="search-input">
            <i class="fas fa-id-card"></i>
            <input type="text" id="id-search" placeholder="ค้นหาด้วย ID"[(ngModel)]="id" (ngModelChange)="doGetId()" >
        </div>
        
        <div class="search-input">
            <i class="fas fa-user"></i>
            <input type="text" id="name-search"[(ngModel)]="name" (ngModelChange)="doSearch()" placeholder="ค้นหาด้วยชื่อ" >
        </div>
    </div>
     <div class="dropdown">
            <select class="dropdown-select" [(ngModel)]="selectedCountry" (change)="doCountry()">
                <option value="">-- กรุณาเลือกประเทศ --</option>
                <option value="" *ngFor="let v of place" [value]="v.country">
                  {{v.country}}</option>
                
          </select>
      </div>
      <button class="btn2" style="margin-left: 10px;" (click)="open()">เพิ่มข้อมูล</button>
</div>
<div>
    <div class="wrap">
  <h1>ทริปท่องเที่ยว</h1>

  <div *ngIf="errorMsg" class="alert">{{ errorMsg }}</div>

  <div *ngIf="loading" class="skeleton-grid">
    <div class="skeleton-card" *ngFor="let s of [0,1,2,3,4,5,6,7,8,9]"></div>
  </div>

  <div class="grid" *ngIf="!loading">
    <div class="card" *ngFor="let t of data">
      <div class="thumb">
        <img [src]="imageOrFallback(t.coverimage)" [alt]="t.name" />
      </div>
      <div class="body">
        <div class="title">
          <span class="name">{{ t.name }}</span>
          <span class="country">• {{ t.country }}</span>
        </div>

        <p class="detail">{{ short(t.detail, 160) }}</p>

        <div class="meta">
          <div class="pill">ระยะเวลา: {{ t.duration }} วัน</div>
          <div class="pill">ปลายทาง #{{ t.destinationid }}</div>
        </div>

        <div class="footer">
          <div class="price">{{ thb(t.price) }}</div>
          
          <button class="btn" (click)="redirect(t.idx)">ดูรายละเอียด</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal" id="addDataModal" [class.active]="isOpen">
  <div class="modal-content">
    <div class="modal-header">
      <h2><i class="fas fa-plus-circle"></i> เพิ่มข้อมูลท่องเที่ยว</h2>
      <button class="close-btn" id="closeModal" (click)="close()">&times;</button>
    </div>

    <div class="modal-body">
      <!-- ใช้ ngSubmit -->
      <form #dataForm="ngForm" (ngSubmit)="Addtrip()">

        <div class="form-col">
          <label for="name" class="required-field">ชื่อสถานที่</label>
          <input type="text" id="name" name="name" required [(ngModel)]="trip_req.name">
        </div>

        <div class="form-col">
          <label class="required-field">ประเทศ</label>
          <select name="country" [(ngModel)]="trip_req.country" required>
            <option value="">-- กรุณาเลือกประเทศ --</option>
            <option *ngFor="let v of place" [value]="v.country">{{ v.country }}</option>
          </select>
        </div>

        <div class="form-col">
          <label class="required-field">ทวีป</label>
          <select name="destinationid" [(ngModel)]="trip_req.destinationid" required>
            <option value="">-- กรุณาเลือกทวีป --</option>
            <option *ngFor="let v of des" [value]="v.idx">{{ v.zone }}</option>
          </select>
        </div>

        <div class="form-col">
          <label for="price" class="required-field">ราคา (บาท)</label>
          <input type="number" id="price" name="price" required [(ngModel)]="trip_req.price">
        </div>

        <div class="form-group">
          <label for="coverimage" class="required-field">URL รูปภาพ</label>
          <input type="text" id="coverimage" name="coverimage" required [(ngModel)]="trip_req.coverimage">
          <p class="form-note">กรอก URL ของภาพ (เช่น https://example.com/image.jpg)</p>
          <!-- bind src preview -->
          <img class="preview-image" [src]="trip_req.coverimage" alt="Preview">
        </div>

        <div class="form-group">
          <label for="duration" class="required-field">ระยะเวลา (วัน)</label>
          <input type="number" id="duration" name="duration" required [(ngModel)]="trip_req.duration">
        </div>

        <div class="form-group">
          <label for="detail" class="required-field">รายละเอียด</label>
          <textarea id="detail" name="detail" required [(ngModel)]="trip_req.detail"></textarea>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="close()">ปิด</button>
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-save"></i> บันทึกข้อมูล
          </button>
        </div>

      </form>
    </div>
  </div>
</div>

  <!-- Pagination -->
  <div class="pager" *ngIf="totalPages > 1">
    <button (click)="goPage(page-1)" [disabled]="page === 1">ก่อนหน้า</button>

    <button
      *ngIf="pagesToShow()[0] > 1"
      class="num"
      (click)="goPage(1)">
      1
    </button>
    <span *ngIf="pagesToShow()[0] > 2" class="dots">…</span>

    <button
      *ngFor="let p of pagesToShow()"
      class="num"
      [class.active]="p === page"
      (click)="goPage(p)">
      {{ p }}
    </button>

    <span *ngIf="pagesToShow()[pagesToShow().length - 1] < totalPages - 1" class="dots">…</span>
    <button
      *ngIf="pagesToShow()[pagesToShow().length - 1] < totalPages"
      class="num"
      (click)="goPage(totalPages)">
      {{ totalPages }}
    </button>

    <button (click)="goPage(page+1)" [disabled]="page === totalPages">ถัดไป</button>
  </div>

  <div class="meta-info">
    หน้า {{ page }} / {{ totalPages }} • ทั้งหมด {{ total | number }} รายการ • ต่อหน้า {{ limit }}
  </div>
</div>

</div>